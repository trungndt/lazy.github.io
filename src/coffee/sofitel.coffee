
$ ->
	_DATA_ALL_EVENTS = [
		{
			'date_added': '30 Jul 2017, 12:18'
			'account_holder': 'KHAYA'
			'event_ref': '02131'
			'event_name': 'Fast Annual Dinner'
			'status': 'Planning'
			'percent': 60
			'contracted_start': '01 Jan 2018'
			'contracted_duration': '2 days'
			'company': 'Lorem Ipsum'
			'customer_name': 'Sylvia Stay'
			'customer_email': 'sylvia@gmail.com'
			'reg': '24/65'
			'is_active': false
			'url': '#'
		},{
			'date_added': '30 Jul 2017, 12:18'
			'account_holder': 'JILEE'
			'event_ref': '034534'
			'event_name': 'Singapore Food Festival'
			'status': 'Planning'
			'percent': 40
			'contracted_start': '01 Jan 2018'
			'contracted_duration': '2 days'
			'company': 'Lorem Ipsum'
			'customer_name': 'Sylvia Stay'
			'customer_email': 'sylvia@gmail.com'
			'reg': '12/43'
			'is_active': false
			'url': 'http://google.com'
		},{
			'date_added': '30 Jul 2017, 12:18'
			'account_holder': 'JOMA'
			'event_ref': '13130',
			'event_name': 'Sunway Conf'
			'status': 'Pending'
			'contracted_start': '01 Jan 2018'
			'contracted_duration': '2 days'
			'company': 'Lorem Ipsum'
			'customer_name': 'Sylvia Stay'
			'customer_email': 'sylvia@gmail.com'
			'reg': '3/42'
			'is_active': false
			'url': '#'
		},{
			'date_added': '30 Jul 2017, 12:18'
			'account_holder': 'DINSMITH'
			'event_ref': '42150',
			'event_name': 'Time Management Event'
			'status': 'Live'
			'contracted_start': '01 Jan 2018'
			'contracted_duration': '2 days'
			'company': 'Lorem Ipsum'
			'customer_name': 'Sylvia Stay'
			'customer_email': 'sylvia@gmail.com'
			'reg': '3/21'
			'is_active': false
			'url': 'http://google.com'
		},{
			'date_added': '30 Jul 2017, 12:18'
			'account_holder': 'KHAYA'
			'event_ref': '02131'
			'event_name': 'Fast Annual Dinner'
			'status': 'Planning'
			'percent': 60
			'contracted_start': '01 Jan 2018'
			'contracted_duration': '2 days'
			'company': 'Lorem Ipsum'
			'customer_name': 'Sylvia Stay'
			'customer_email': 'sylvia@gmail.com'
			'reg': '24/65'
			'is_active': false
			'url': '#'
		},{
			'date_added': '30 Jul 2017, 12:18'
			'account_holder': 'JILEE'
			'event_ref': '034534'
			'event_name': 'Singapore Food Festival'
			'status': 'Planning'
			'percent': 40
			'contracted_start': '01 Jan 2018'
			'contracted_duration': '2 days'
			'company': 'Lorem Ipsum'
			'customer_name': 'Sylvia Stay'
			'customer_email': 'sylvia@gmail.com'
			'reg': '12/43'
			'is_active': false
			'url': 'http://google.com'
		},{
			'date_added': '30 Jul 2017, 12:18'
			'account_holder': 'JOMA'
			'event_ref': '13130',
			'event_name': 'Sunway Conf'
			'status': 'Pending'
			'contracted_start': '01 Jan 2018'
			'contracted_duration': '2 days'
			'company': 'Lorem Ipsum'
			'customer_name': 'Sylvia Stay'
			'customer_email': 'sylvia@gmail.com'
			'reg': '3/42'
			'is_active': false
			'url': '#'
		},{
			'date_added': '30 Jul 2017, 12:18'
			'account_holder': 'DINSMITH'
			'event_ref': '42150',
			'event_name': 'Time Management Event'
			'status': 'Live'
			'contracted_start': '01 Jan 2018'
			'contracted_duration': '2 days'
			'company': 'Lorem Ipsum'
			'customer_name': 'Sylvia Stay'
			'customer_email': 'sylvia@gmail.com'
			'reg': '3/21'
			'is_active': false
			'url': 'http://google.com'
		},{
			'date_added': '30 Jul 2017, 12:18'
			'account_holder': 'KHAYA'
			'event_ref': '02131'
			'event_name': 'Fast Annual Dinner'
			'status': 'Planning'
			'percent': 60
			'contracted_start': '01 Jan 2018'
			'contracted_duration': '2 days'
			'company': 'Lorem Ipsum'
			'customer_name': 'Sylvia Stay'
			'customer_email': 'sylvia@gmail.com'
			'reg': '24/65'
			'is_active': false
			'url': '#'
		},{
			'date_added': '30 Jul 2017, 12:18'
			'account_holder': 'JILEE'
			'event_ref': '034534'
			'event_name': 'Singapore Food Festival'
			'status': 'Planning'
			'percent': 40
			'contracted_start': '01 Jan 2018'
			'contracted_duration': '2 days'
			'company': 'Lorem Ipsum'
			'customer_name': 'Sylvia Stay'
			'customer_email': 'sylvia@gmail.com'
			'reg': '12/43'
			'is_active': false
			'url': 'http://google.com'
		},{
			'date_added': '30 Jul 2017, 12:18'
			'account_holder': 'JOMA'
			'event_ref': '13130',
			'event_name': 'Sunway Conf'
			'status': 'Pending'
			'contracted_start': '01 Jan 2018'
			'contracted_duration': '2 days'
			'company': 'Lorem Ipsum'
			'customer_name': 'Sylvia Stay'
			'customer_email': 'sylvia@gmail.com'
			'reg': '3/42'
			'is_active': false
			'url': '#'
		},{
			'date_added': '30 Jul 2017, 12:18'
			'account_holder': 'DINSMITH'
			'event_ref': '42150',
			'event_name': 'Time Management Event'
			'status': 'Live'
			'contracted_start': '01 Jan 2018'
			'contracted_duration': '2 days'
			'company': 'Lorem Ipsum'
			'customer_name': 'Sylvia Stay'
			'customer_email': 'sylvia@gmail.com'
			'reg': '3/21'
			'is_active': false
			'url': 'http://google.com'
		},{
			'date_added': '30 Jul 2017, 12:18'
			'account_holder': 'KHAYA'
			'event_ref': '02131'
			'event_name': 'Fast Annual Dinner'
			'status': 'Planning'
			'percent': 60
			'contracted_start': '01 Jan 2018'
			'contracted_duration': '2 days'
			'company': 'Lorem Ipsum'
			'customer_name': 'Sylvia Stay'
			'customer_email': 'sylvia@gmail.com'
			'reg': '24/65'
			'is_active': false
			'url': '#'
		},{
			'date_added': '30 Jul 2017, 12:18'
			'account_holder': 'JILEE'
			'event_ref': '034534'
			'event_name': 'Singapore Food Festival'
			'status': 'Planning'
			'percent': 40
			'contracted_start': '01 Jan 2018'
			'contracted_duration': '2 days'
			'company': 'Lorem Ipsum'
			'customer_name': 'Sylvia Stay'
			'customer_email': 'sylvia@gmail.com'
			'reg': '12/43'
			'is_active': false
			'url': 'http://google.com'
		},{
			'date_added': '30 Jul 2017, 12:18'
			'account_holder': 'JOMA'
			'event_ref': '13130',
			'event_name': 'Sunway Conf'
			'status': 'Pending'
			'contracted_start': '01 Jan 2018'
			'contracted_duration': '2 days'
			'company': 'Lorem Ipsum'
			'customer_name': 'Sylvia Stay'
			'customer_email': 'sylvia@gmail.com'
			'reg': '3/42'
			'is_active': false
			'url': '#'
		},{
			'date_added': '30 Jul 2017, 12:18'
			'account_holder': 'DINSMITH'
			'event_ref': '42150',
			'event_name': 'Time Management Event'
			'status': 'Live'
			'contracted_start': '01 Jan 2018'
			'contracted_duration': '2 days'
			'company': 'Lorem Ipsum'
			'customer_name': 'Sylvia Stay'
			'customer_email': 'sylvia@gmail.com'
			'reg': '3/21'
			'is_active': false
			'url': 'http://google.com'
		}
	]

	_DATA_ALL_GROUP_RES = [
		{
			'date_added': '30 Jul 2017, 12:18'
			'account_holder': 'KHAYA'
			'res_code': '02131'
			'event': 'Y'
			'status': 'Open'
			'contracted_start': '01 Jan 2018'
			'contracted_duration': '2 days'
			'company': 'Lorem Ipsum'
			'customer_name': 'Sylvia Stay'
			'customer_email': 'sylvia@gmail.com'
			'reg': '24/65'
			'pen': 10
			'edit': 5
			'url': '#'
		},{
			'date_added': '30 Jul 2017, 12:18'
			'account_holder': 'JILEE'
			'res_code': '034534'
			'event': 'Y'
			'status': 'Cancelled'
			'contracted_start': '01 Jan 2018'
			'contracted_duration': '2 days'
			'company': 'Lorem Ipsum'
			'customer_name': 'Sylvia Stay'
			'customer_email': 'sylvia@gmail.com'
			'reg': '12/43'
			'pen': 10
			'edit': 5
			'url': 'http://google.com'
		},{
			'date_added': '30 Jul 2017, 12:18'
			'account_holder': 'JOMA'
			'res_code': '13130',
			'event': 'N'
			'status': 'Open'
			'contracted_start': '01 Jan 2018'
			'contracted_duration': '2 days'
			'company': 'Lorem Ipsum'
			'customer_name': 'Sylvia Stay'
			'customer_email': 'sylvia@gmail.com'
			'reg': '3/42'
			'pen': 10
			'edit': 5
			'url': '#'
		},{
			'date_added': '30 Jul 2017, 12:18'
			'account_holder': 'DINSMITH'
			'res_code': '42150',
			'event': 'N'
			'status': 'Open'
			'contracted_start': '01 Jan 2018'
			'contracted_duration': '2 days'
			'company': 'Lorem Ipsum'
			'customer_name': 'Sylvia Stay'
			'customer_email': 'sylvia@gmail.com'
			'reg': '3/21'
			'pen': 10
			'edit': 5
			'url': 'http://google.com'
		}
	]

	class General
		@init: ->
			$('.nice-select').niceSelect()
			$('.image-dd').msDropDown()
			do this.setupDatePicker
			do this.setupTimePicker
			do this.setupSidebarToggle
			do this.setupSwitcher
			return
		@activateCurrentPage: ->
			return
		@setupDatePicker: ->
			$('.date-picker').datepicker
				'dateFormat': 'dd M yy'
			return
		@setupTimePicker: ->
			$('.time-picker').timepicker
				'scrollDefault': 'now'
				'timeFormat': 'h:i A'
			return
		@setupSidebarToggle: ->
			$(document).on 'click', '#sidebar .sub-menu a', ->
				$(this).parent().toggleClass('toggled')
				$(this).next().slideToggle(100)
			return
		@setupSwitcher: ->
			$(document).on 'click', '.switcher input[type="radio"]', ->
				$(this).closest('.switcher').find('.active').removeClass('active')
				$(this).closest('.switcher-option').addClass('active')
				return


	class DataTableCustom
		@getDom: ->
			'<"top" <"row form-horizontal" <"col-sm-2 col-status"> <"col-sm-3"f> <"col-sm-7 text-right"l> > > rt <"bottom"p><"clear">'
		@getLanguageCustom: (placeholder) ->
			lengthMenu: 'Display _MENU_ per page'
			search: ''
			searchPlaceholder: placeholder
			paginate:
				previous: '<'
				next: '>'
		@setupStatusFilter: (_this, filterCol) ->
			$me = $(_this)
			column = _this.api().column(filterCol)
			# Remove unnecessary class
			$me.parent().removeClass('form-inline')
			$me.parent().find('.input-sm').removeClass('input-sm')
			# Create Dropdown filter
			$select = $('<select/>', {
					'class': 'form-control drop-filter',
					'html': $('<option/>', {
							'value': '',
							'html': 'Filter by status'
						})
				})
			# Add Options for filter based on unique status values
			column.data().unique().sort().each (e,i) ->
				$select.append($('<option/>', {
					'value': e,
					'html': e
				}))

			# Event: Filter table by status change
			$select.on 'change', ->
				val = $.fn.dataTable.util.escapeRegex($(this).val())
				column.search( val ? '^'+val+'$' : '', true, false).draw()

			$me.prev().find('.col-status').prepend($select)
		@getElemLink: (url, text, cls) ->
			targetAttr = if url != '#' then 'target="_blank"' else ''
			'<a href="' + url + '" class="' + (cls || '') + '" ' + targetAttr + '>' + (text || '') + '</a>'


	class CreateNewBlock
		@init: ->
			# [EvENT] 
			$(document).on 'change', '#cbbEventType', ->
				$txtOther = $('#txtOtherEvent')
				if this.value == 'Other'
					$txtOther.show()
				else
					$txtOther.hide()
				return

			# [EvENT] 
			$(document).on 'change', '[data-action="disable-accordion"]', (e) ->
				$panel = $(this).closest('.panel')
				if $(this).prop('checked')
					$panel.addClass('disabled')
					$panel.find('.panel-collapse').collapse('hide')
				else
					$panel.removeClass('disabled')
				return

			# [EvENT] Disable accordion when class "disabled" is added
			$(document).on 'show.bs.collapse', '.disabled .panel-collapse', (e) ->
				preventDefault(e)
				return

			# [EvENT] Click on button "Continue" to mark a step as complete
			$(document).on 'click', '[data-action="complete-step"]', (e) ->
				
				return
			return


	class AllEvents
		@init: ->
			do this.setupDataTables
			return

		@setupDataTables: ->
			$('#tblAllEvents').DataTable
				data: _DATA_ALL_EVENTS
				dom: DataTableCustom.getDom()
				language: DataTableCustom.getLanguageCustom('Search event reference/name...')
				columns: [
					{ data: 'date_added' },
					{ data: 'account_holder' },
					{ data: 'event_ref' },
					{ data: 'event_name' },
					{ data: 'contracted_start' },
					{ data: 'company' },
					{ data: 'customer_name' },
					{ data: 'reg' },
					{ data: 'url' },
					{ data: 'status' }
				]
				columnDefs: [
					targets: 2,
					render: (data, type, row) ->
						DataTableCustom.getElemLink(row.url, data)
				,
					targets: 3
					render: (data, type, row) ->
						mapper =
							'planning': 'tag-warning'
							'live': 'tag-success'
							'pending': 'tag-default'
						cls = 'tag ' + mapper[row.status.toLowerCase()]
						cls += ' status-' + row.status.toLowerCase()
						# content = row.status + row.status == 'Planning' ? row.percent : ' ')
						content = row.status + (if row.status == 'Planning' then ' ' + row.percent + '%' else '')
						DataTableCustom.getElemLink(row.url, data) + '<br/><div class="' + cls + '">' + content + '</div>'
				,
					targets: 4
					render: (data, type, row) ->
						data + '<br/><small>' + row.contracted_duration + '</small>'
				,
					targets: 6
					render: (data, type, row) ->
						data + '<br/><small class="customer-email">' + row.customer_email + '</small>'
				,
					targets: 8
					render: (data, type, row) ->
						cls = 'icon icon-globe' + (if data == '#' then '-disabled' else '')
						DataTableCustom.getElemLink(data, '', cls)
				,
					targets: 9
					visible: false
					searchable: true
				]
				initComplete: (a, b, c) ->
					DataTableCustom.setupStatusFilter(this, 9)
					# $me.prev().find('select').addClass('nice-select').niceSelect()
					false
			return


	class AllGroupRes
		@init: ->
			do this.setupDataTables
			return

		@setupDataTables: ->
			$('#tblAllGroupRes').DataTable
				data: _DATA_ALL_GROUP_RES
				dom: DataTableCustom.getDom()
				language: DataTableCustom.getLanguageCustom('Search reservation code...')
				columns: [
					{ data: 'date_added' },
					{ data: 'account_holder' },
					{ data: 'res_code' },
					{ data: 'event' },
					{ data: 'contracted_start' },
					{ data: 'company' },
					{ data: 'customer_name' },
					{ data: 'reg' },
					{ data: 'pen' },
					{ data: 'edit' },
					{ data: 'url' },
					{ data: 'status' }
				]
				columnDefs: [
					targets: 2 # Column: Res Code
					render: (data, type, row) ->
						mapper =
							'open': 'tag-success'
							'cancelled': 'tag-default'
						cls = 'tag ' + mapper[row.status.toLowerCase()]
						cls += ' status-' + row.status.toLowerCase()
						content = row.status
						'<a href="' + row.url + '">' + data + '</a><br/><div class="' + cls + '">' + content + '</div>'
				,
					targets: 4
					render: (data, type, row) ->
						data + '<br/><small>' + row.contracted_duration + '</small>'
				,
					targets: 6
					render: (data, type, row) ->
						data + '<br/><small class="customer-email">' + row.customer_email + '</small>'
				,
					targets: 10
					render: (data, type, row) ->
						cls = 'icon icon-globe' + (if data == '#' then '-disabled' else '')
						targetAttr = if data != '#' then 'target="_blank"' else ''
						'<a href="' + data + '" class="' + cls + '" ' + targetAttr + '></a>'
				,
					targets: 11
					visible: false
					searchable: true
				]
				initComplete: (a, b, c) ->
					DataTableCustom.setupStatusFilter(this, 11)
					# $me.prev().find('select').addClass('nice-select').niceSelect()
					false
			return

	do General.init
	do CreateNewBlock.init
	do AllEvents.init
	do AllGroupRes.init
	return